{% extends "layout.twig" %}

{% block content %}
    <div class="d-flex align-items-center justify-content-between mb-3">
        <div>
            <h1 class="h4 mb-1">{{ pet.name }}</h1>
            <div class="text-muted small">
                Клиент:
                <a href="/clients/{{ pet.client_id }}" class="text-decoration-none">{{ pet.client_full_name }}</a>
            </div>
        </div>

        <div class="d-flex gap-2">
            <a class="btn btn-outline-secondary" href="/clients/{{ pet.client_id }}">К клиенту</a>
            <a class="btn btn-outline-secondary" href="/pets">Все питомцы</a>

            {# Редактирование — зелёная кнопка #}
            <a class="btn btn-success" href="/pets/{{ pet.id }}/edit">Редактировать питомца</a>

            {# Удаление питомца — красная кнопка (POST) #}
            <form method="post"
                  action="/pets/{{ pet.id }}/delete"
                  onsubmit="return confirm('Удалить питомца «{{ pet.name }}» и все его визиты?');">
                <button class="btn btn-danger" type="submit">Удалить питомца</button>
            </form>

            <a class="btn btn-primary" href="/pets/{{ pet.id }}/visits/create">+ Визит</a>
        </div>
    </div>

    <div class="bg-white rounded shadow-sm p-4 mb-3">
        <div class="row g-3">
            <div class="col-md-6">
                <div class="fw-semibold">Вид</div>
                <div>{{ pet.species|default('—') }}</div>
            </div>

            <div class="col-md-6">
                <div class="fw-semibold">Порода</div>
                <div>{{ pet.breed|default('—') }}</div>
            </div>

            <div class="col-md-6">
                <div class="fw-semibold">Дата рождения</div>
                <div>{{ pet.birth_date_view ? pet.birth_date_view : '—' }}</div>
            </div>

            <div class="col-md-6">
                <div class="fw-semibold">Лекарства (текст)</div>
                <div class="text-break">{{ pet.medications|default('—') }}</div>
            </div>

            <div class="col-12">
                <div class="fw-semibold">Заметки</div>
                <div class="text-break">{{ pet.notes|default('—') }}</div>
            </div>
        </div>
    </div>

    <div class="bg-white rounded shadow-sm p-3">
        <div class="d-flex align-items-center justify-content-between mb-2">
            <h2 class="h6 mb-0">Визиты (посещаемость)</h2>
            <a class="btn btn-sm btn-outline-primary" href="/pets/{{ pet.id }}/visits/create">Добавить визит</a>
        </div>

        <div class="table-responsive">
            <table class="table table-striped mb-0 align-middle">
                <thead>
                <tr>
                    <th style="width: 70px;">ID</th>
                    <th style="width: 140px;">Дата</th>
                    <th style="width: 100px;">Время</th>
                    <th>Жалоба</th>
                    <th>Диагноз</th>
                    <th style="width: 190px;">Действия</th>
                </tr>
                </thead>
                <tbody>
                {% for v in visits %}
                    <tr>
                        <td>{{ v.id }}</td>
                        <td>{{ v.visit_date|default('—') }}</td>
                        <td>{{ v.visit_time|default('—') }}</td>
                        <td>{{ v.complaint|default('—') }}</td>
                        <td>{{ v.diagnosis|default('—') }}</td>
                        <td>
                            <div class="d-flex gap-2">
                                {# Редактирование визита — зелёная кнопка #}
                                <a class="btn btn-sm btn-success"
                                   href="/pets/{{ pet.id }}/visits/{{ v.id }}/edit">Редактировать</a>

                                <form method="post"
                                      action="/pets/{{ pet.id }}/visits/{{ v.id }}/delete"
                                      onsubmit="return confirm('Удалить визит #{{ v.id }}?');">
                                    <button class="btn btn-sm btn-outline-danger" type="submit">Удалить</button>
                                </form>
                            </div>
                        </td>
                    </tr>
                    {% if v.procedures or v.recommendations %}
                        <tr>
                            <td colspan="6" class="small text-muted">
                                {% if v.procedures %}<div><strong>Процедуры:</strong> {{ v.procedures }}</div>{% endif %}
                                {% if v.recommendations %}<div><strong>Рекомендации:</strong> {{ v.recommendations }}</div>{% endif %}
                            </td>
                        </tr>
                    {% endif %}
                {% else %}
                    <tr>
                        <td colspan="6" class="text-center text-muted py-4">Визитов пока нет</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
{% endblock %}
